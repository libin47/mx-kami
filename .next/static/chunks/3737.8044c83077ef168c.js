(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3737],{45953:function(d,b,a){"use strict";a.d(b,{K:function(){return g}});var c=a(93236),e=a(19103),f=a(10861),g=(0,c.memo)(function(a){return(0,f.O)()?(0,e.createPortal)(a.children,document.body):null})},63737:function(k,b,a){"use strict";a.r(b),a.d(b,{MusicMiniPlayer:function(){return F},MusicMiniPlayerStoreControlled:function(){return I},"_MusicMiniPlayerStoreControlled":function(){return j}});var d=a(4544),l=a.n(d),m=a(62086),n=a(51626),e=a(20057),c=a(67201),f=a(93236),o=function(a,b){return(o=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(a,b){a.__proto__=b}||function(c,a){for(var b in a)Object.prototype.hasOwnProperty.call(a,b)&&(c[b]=a[b])})(a,b)},p=function(){return(p=Object.assign||function(d){for(var a,b=1,e=arguments.length;b<e;b++)for(var c in a=arguments[b])Object.prototype.hasOwnProperty.call(a,c)&&(d[c]=a[c]);return d}).apply(this,arguments)};function q(a){return this instanceof q?(this.v=a,this):new q(a)}var r=function(a){void 0===a&&(a={});var b=(0,f.useState)(a),c=b[0],e=b[1],d=(0,f.useCallback)(function(a){e(function(b){return Object.assign({},b,a instanceof Function?a(b):a)})},[]);return[c,d]};function s(b){for(var c=[],a=0;a<b.length;a++)c.push({start:b.start(a),end:b.end(a)});return c}var g,t=(g="audio",function(d){a=f.isValidElement(d)?(c=d).props:d;var c,a,h=r({buffered:[],time:0,duration:0,paused:!0,muted:!1,volume:1,playing:!1}),t=h[0],v=h[1],e=(0,f.useRef)(null),b=function(a,b){return function(c){try{b&&b(c)}finally{a&&a(c)}}},i=function(){return v({paused:!1})},j=function(){return v({playing:!0})},k=function(){return v({playing:!1})},l=function(){return v({paused:!0,playing:!1})},m=function(){var a=e.current;a&&v({muted:a.muted,volume:a.volume})},n=function(){var a=e.current;if(a){var b=a.duration,c=a.buffered;v({duration:b,buffered:s(c)})}},o=function(){var a=e.current;a&&v({time:a.currentTime})},q=function(){var a=e.current;a&&v({buffered:s(a.buffered)})};c=c?f.cloneElement(c,p(p({controls:!1},a),{ref:e,onPlay:b(a.onPlay,i),onPlaying:b(a.onPlaying,j),onWaiting:b(a.onWaiting,k),onPause:b(a.onPause,l),onVolumeChange:b(a.onVolumeChange,m),onDurationChange:b(a.onDurationChange,n),onTimeUpdate:b(a.onTimeUpdate,o),onProgress:b(a.onProgress,q)})):f.createElement(g,p(p({controls:!1},a),{ref:e,onPlay:b(a.onPlay,i),onPlaying:b(a.onPlaying,j),onWaiting:b(a.onWaiting,k),onPause:b(a.onPause,l),onVolumeChange:b(a.onVolumeChange,m),onDurationChange:b(a.onDurationChange,n),onTimeUpdate:b(a.onTimeUpdate,o),onProgress:b(a.onProgress,q)}));var w=!1,u={play:function(){var b=e.current;if(b&&!w){var a=b.play();if("object"==typeof a){w=!0;var c=function(){w=!1};a.then(c,c)}return a}},pause:function(){var a=e.current;if(a&&!w)return a.pause()},seek:function(a){var b=e.current;b&& void 0!==t.duration&&(a=Math.min(t.duration,Math.max(0,a)),b.currentTime=a)},volume:function(a){var b=e.current;b&&(a=Math.min(1,Math.max(0,a)),b.volume=a,v({volume:a}))},mute:function(){var a=e.current;a&&(a.muted=!0)},unmute:function(){var a=e.current;a&&(a.muted=!1)}};return(0,f.useEffect)(function(){var b=e.current;b&&(v({volume:b.volume,muted:b.muted,paused:b.paused}),a.autoPlay&&b.paused&&u.play())},[a.src]),[c,t,u,e]}),h=a(32872),u=a(45953),v=a(10609),w=a(74321),x=a(38325),i=a(81378),y=a.n(i);function z(c,a){(null==a||a>c.length)&&(a=c.length);for(var b=0,d=new Array(a);b<a;b++)d[b]=c[b];return d}function A(c,d,e,f,g,h,i){try{var a=c[h](i),b=a.value}catch(j){e(j);return}a.done?d(b):Promise.resolve(b).then(f,g)}function B(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function C(d){for(var a=1;a<arguments.length;a++){var c=null!=arguments[a]?arguments[a]:{},b=Object.keys(c);"function"==typeof Object.getOwnPropertySymbols&&(b=b.concat(Object.getOwnPropertySymbols(c).filter(function(a){return Object.getOwnPropertyDescriptor(c,a).enumerable}))),b.forEach(function(a){B(d,a,c[a])})}return d}function D(a,b){return function(a){if(Array.isArray(a))return a}(a)||function(b,e){var f,g,a=null==b?null:"undefined"!=typeof Symbol&&b[Symbol.iterator]||b["@@iterator"];if(null!=a){var c=[],d=!0,h=!1;try{for(a=a.call(b);!(d=(f=a.next()).done)&&(c.push(f.value),!e||c.length!==e);d=!0);}catch(i){h=!0,g=i}finally{try{d||null==a.return||a.return()}finally{if(h)throw g}}return c}}(a,b)||E(a,b)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function E(a,c){if(a){if("string"==typeof a)return z(a,c);var b=Object.prototype.toString.call(a).slice(8,-1);if("Object"===b&&a.constructor&&(b=a.constructor.name),"Map"===b||"Set"===b)return Array.from(b);if("Arguments"===b||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(b))return z(a,c)}}var F=(0,f.forwardRef)(function(c,p){var q,r,d=c.playlist,g=c.hide,s=c.onPlayStateChange,E=c.onChange,F=d.length,i=(0,f.useState)(null),a=i[0],G=i[1],j=(0,f.useState)(0),u=j[0],H=j[1],I=(r=(q=l().mark(function a(b){var c,d,e,f,g,i,j,k=arguments;return l().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(c=k.length>1&& void 0!==k[1]?k[1]:"netease",b){a.next=4;break}return a.abrupt("return");case 4:return a.next=6,fetch("".concat("https://api.i-meto.com/meting/api","/?server=").concat(c,"&id=").concat(b));case 6:return e=a.sent,a.next=9,e.json();case 9:return f=a.sent,a.t0=D,a.next=13,h.x1.serverless.proxy.kami.song.get({params:{id:b}});case 13:a.t1=a.sent,j=null===(d=(i=(g=(0,a.t0)(a.t1,1))[0]).url)|| void 0===d?void 0:d.replace("http://","https://"),G(C({},f[0],{id:b,url:j}));case 18:case"end":return a.stop()}},a)}),function(){var a=this,b=arguments;return new Promise(function(d,e){var f=q.apply(a,b);function c(a){A(f,d,e,c,g,"next",a)}function g(a){A(f,d,e,c,g,"throw",a)}c(void 0)})}),function(a){return r.apply(this,arguments)});(0,f.useEffect)(function(){I(d[u])},[u,d]),(0,f.useEffect)(function(){G(null),H(0)},[d]);var k=(0,f.useCallback)(function(b){var a=b.target;J.current&&a.paused&&a.play()},[]),e=D(t({src:(null==a?void 0:a.url)||"",autoPlay:!1,loop:!1,onEnded:function(){H(function(a){return++a%F})},onLoadedData:k,onTimeUpdate:function(c){if(E){var b=c.target,d=b.duration,e=b.currentTime;E((null==a?void 0:a.id)||0,e,d)}},onLoad:k}),3),v=e[0],b=e[1],o=e[2],J=(0,f.useRef)(!1),w=(0,f.useCallback)(function(){o.play(),J.current=!0},[o]),x=(0,f.useCallback)(function(){o.pause(),J.current=!1},[o]);(0,f.useImperativeHandle)(p,function(){return{pause:x,play:w,setCursor:function(a){H(a%F)},next:function(){H(function(a){return++a%F})},prev:function(){H(function(a){return--a%F})},seek:function(a){o.seek(a)}}});var z=(0,f.useCallback)(function(){b.paused?(w(),s("play")):(x(),s("pause"))},[s,x,w,b.paused]),B=(0,f.useMemo)(function(){return(null==a?void 0:a.pic)&&(0,m.jsx)("div",{className:(0,n.Z)(y().pic,"bg-cover bg-center bg-no-repeat h-full w-full"),style:{backgroundImage:"url(".concat(a.pic,")")}})},[null==a?void 0:a.pic]);return(0,m.jsx)("div",{className:(0,n.Z)(y().player,!b.paused&&y().play,void 0!==g&&g&&y().hide),children:(0,m.jsxs)("div",{className:y().root,children:[(0,m.jsxs)("div",{className:y().cover,children:[B,(0,m.jsx)("div",{className:(0,n.Z)(y()["control-btn"]),onClick:z,children:b.paused?(0,m.jsx)("svg",{width:"1em",height:"1em",viewBox:"0 0 24 24",children:(0,m.jsx)("path",{d:"M8 6.82v10.36c0 .79.87 1.27 1.54.84l8.14-5.18a1 1 0 0 0 0-1.69L9.54 5.98A.998.998 0 0 0 8 6.82z",fill:"currentColor"})}):(0,m.jsxs)("svg",{width:"1em",height:"1em",viewBox:"0 0 32 32",children:[(0,m.jsx)("path",{d:"M12 6h-2a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2z",fill:"currentColor"}),(0,m.jsx)("path",{d:"M22 6h-2a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2z",fill:"currentColor"})]})}),a&&v]}),a&&(0,m.jsxs)("div",{className:y().tip,onClick:function(){window.open(a.url)},children:[(0,m.jsx)("p",{children:a.title}),(0,m.jsx)("p",{className:"text-sm text-gray-2",children:a.author}),(0,m.jsxs)("p",{className:"text-xs text-opacity-80",children:[(0,h.WZ)(0|b.time),"/",(0,h.WZ)(0|b.duration)]})]})]})})}),G=(0,c.Pi)(function(){var b=(0,x.oR)().musicStore.playProgress,a=(0,f.useDeferredValue)(b);return 0===a?null:(0,m.jsx)(u.K,{children:(0,m.jsx)("div",{className:"fixed bottom-0 left-0 origin-left transform-gpu ease-linear transition-transform right-0 transform scale-y-50 pt-[2px] bg-yellow duration-1000 z-99",style:{transform:"scaleX(".concat(a,")")}})})}),H=(0,e.Z)(function(a,b,c){x.h.musicStore.setPlayingInfo(a,b,c)},1e3,{trailing:!1}),j=(0,c.Pi)(function(){var b=(0,f.useRef)(null),a=(0,x.oR)().musicStore,d=(0,w.e)().event;(0,f.useEffect)(function(){if(!b.current){console.log("player not ready");return}a.isPlay?requestAnimationFrame(function(){var c;d({action:v.b.Interaction,label:"\u97F3\u4E50\u64AD\u653E\u72B6\u6001\uFF1A".concat(a.isPlay?"\u64AD\u653E":"\u6682\u505C")}),null===(c=b.current)|| void 0===c||c.play()}):b.current.pause()},[a.isPlay]),(0,f.useEffect)(function(){if(a.isHide){var c;null===(c=b.current)|| void 0===c||c.pause()}},[a.isHide]);var c=(0,f.useCallback)(function(b){"play"===b?a.isPlay=!0:a.isPlay=!1},[]);return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(F,{ref:b,onPlayStateChange:c,playlist:a.list,hide:a.isHide,onChange:H}),(0,m.jsx)(G,{})]})}),I=(0,h.ri)(j)},10861:function(c,b,a){"use strict";a.d(b,{O:function(){return f}});var d=a(93236),e=a(32872),f=function(){var a=(0,d.useState)((0,e.S_)()),b=a[0],c=a[1];return(0,d.useEffect)(function(){c(!0)},[]),b}},81378:function(a){a.exports={player:"Player_player__kcVnk",hide:"Player_hide__qvOTL",root:"Player_root__kQLu4",cover:"Player_cover__EM5FM","anime-frame":"Player_anime-frame__Sxt1q",pic:"Player_pic__kAENT","control-btn":"Player_control-btn__6z1aa",play:"Player_play__Z5Ecl",tip:"Player_tip__OWkUl"}}}])